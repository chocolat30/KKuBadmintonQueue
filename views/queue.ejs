<!DOCTYPE html>
<html>

<head>
  <title>Badminton Queue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    /* Make buttons bigger and spaced on mobile */
    .btn {
      min-width: 80px;
      margin-bottom: 4px;
    }

    .queue-actions a {
      margin-right: 4px;
      margin-bottom: 4px;
    }

    /* Stack action buttons vertically on small screens */
    @media (max-width: 576px) {
      .queue-actions {
        display: flex;
        flex-direction: column;
      }
    }
  </style>
</head>

<body class="bg-light">

  <div class="container mt-4">

    <h1 class="text-center mb-4">Badminton Queue</h1>

    <!-- Join Queue -->
    <form action="/join" method="POST" class="mb-4">
      <div class="input-group input-group-lg">
        <input type="text" name="name" class="form-control" placeholder="Pair name" required>
        <button class="btn btn-primary btn-lg">Join Queue</button>
      </div>
    </form>

    <!-- Admin Controls -->
    <div class="mb-4 queue-actions">
      <a href="/start" class="btn btn-primary">Start Match</a>
      <a href="/history" class="btn btn-secondary">Match History</a>
      <a href="/clear-queue" class="btn btn-warning"
        onclick="return confirm('Are you sure you want to clear the entire queue?');">Clear Queue</a>
      <a href="/reset-match" class="btn btn-warning">Reset Match</a>
    </div>

    <!-- Current Match -->
    <h3>Current Match</h3>
    <ul class="list-group mb-4">
      <% if (match.length===0) { %>
        <li class="list-group-item">No active match</li>
        <% } else { %>
          <% match.forEach(m=> { %>
            <li class="list-group-item">

              <div class="fw-bold text-primary mb-2">Active Match</div>

              <!-- TEAM A -->
              <div class="p-2 border rounded mb-3" style="background:#e9f7ef;">
                <span class="badge bg-success w-100 d-block text-truncate mb-2">
                  Team A: <%= m.teamA %> (Played: <%= m.matchesPlayedA %>)
                </span>

                <div class="d-flex flex-wrap gap-2">
                  <a href="/end?w=A" class="btn btn-success btn-sm">Team A Won</a>

                  <% if (m.matchesPlayedA===0) { %>
                    <a href="/add-match/A" class="btn btn-warning btn-sm">+1 Match</a>
                    <% } else if (m.matchesPlayedA===1) { %>
                      <a href="/minus-match/A" class="btn btn-secondary btn-sm">-1 Match</a>
                      <% } %>
                </div>

              </div>

              <!-- TEAM B -->
              <div class="p-2 border rounded mb-3" style="background:#fdecea;">
                <span class="badge bg-danger w-100 d-block text-truncate mb-2">
                  Team B: <%= m.teamB %> (Played: <%= m.matchesPlayedB %>)
                </span>

                <div class="d-flex flex-wrap gap-2">
                  <a href="/end?w=B" class="btn btn-danger btn-sm">Team B Won</a>

                  <% if (m.matchesPlayedB===0) { %>
                    <a href="/add-match/B" class="btn btn-warning btn-sm">+1 Match</a>
                    <% } else if (m.matchesPlayedB===1) { %>
                      <a href="/minus-match/B" class="btn btn-secondary btn-sm">-1 Match</a>
                      <% } %>
                </div>

              </div>

              <div class="text-muted small">
                Started at: <%= new Date(Number(m.timestamp)).toLocaleString('en-GB') %>
              </div>

            </li>
            <% }) %>
              <% } %>
    </ul>



    <!-- Queue -->
    <h3>Queue</h3>
    <ul class="list-group mb-4">
      <% if (queue.length===0) { %>
        <li class="list-group-item">Queue is empty</li>
        <% } else { %>
          <% queue.forEach((q, i)=> { %>
            <li
              class="list-group-item d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center">
              <div>
                <strong>
                  <%= i+1 %>.
                </strong>
                <%= q.name %>
              </div>
              <div class="d-flex flex-wrap mt-2 mt-sm-0">
                <% if (i> 0) { %>
                  <a href="/move/<%= q.id %>/up" class="btn btn-sm btn-outline-secondary me-1">UP</a>
                  <% } %>
                    <% if (i < queue.length - 1) { %>
                      <a href="/move/<%= q.id %>/down" class="btn btn-sm btn-outline-secondary me-1">DOWN</a>
                      <% } %>
                        <a href="/remove/<%= q.id %>" class="btn btn-sm btn-outline-danger">Remove</a>
              </div>
            </li>
            <% }) %>
              <% } %>
    </ul>

    <!-- Alerts -->
    <% if (msg==='active' ) { %>
      <div class="alert alert-warning">A match is already active!</div>
      <% } %>
        <% if (msg==='notenough' ) { %>
          <div class="alert alert-danger">Not enough pairs to start a match. Need 2 pairs.</div>
          <% } %>
            <% if (msg==='started' ) { %>
              <div class="alert alert-success">Match started successfully!</div>
              <% } %>

  </div>

</body>

</html>